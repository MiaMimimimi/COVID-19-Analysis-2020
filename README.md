# COVID-19 SNP Analysis (USA, 2020)

This project uses publicly available SARS-CoV-2 genome data from **GISAID** (restricted to USA samples) to study the rapidly evolving pattern of the virus, highlighting both **spatial** and **temporal dynamics** during the early pandemic.

- **Data source:** GISAID (downloaded November 2020)  
- **Total genomes downloaded:** 32,156  
- **Subset for analysis:** 1,930 randomly selected genomes (see [`single_genome`](./single_genome), [`sample_info.txt`](./sample_info.txt)) were used for SNP analysis, and 664 genomes (see [`single_genome`](./single_genome), [`sample_info2.txt`](./sample_info2.txt)) were further selected for phylogeny inference.  
- **Reference strain:** `coronavirus_Wuhan.fa` (NC_045512.2)

---

## SNP Calling

The directory [`SNP`](./SNP) contains the scripts, intermediate files, and analysis outputs related to SNP discovery and downstream processing.

- [`snp_calling.sh`](./SNP/snp_calling.sh): script for SNP calling using the **kSNP3** package.  
  > Gardner, S. N., Slezak, T., & Hall, B. G. (2015). *kSNP3.0: SNP detection and phylogenetic analysis of genomes without genome alignment or reference genome*. Bioinformatics, 31(17), 2877–2878. https://doi.org/10.1093/bioinformatics/btv271  

- [`plink/`](./SNP/plink): contains conversion scripts and PLINK outputs.  
  > Purcell, S., Neale, B., Todd-Brown, K., Thomas, L., Ferreira, M. A., Bender, D., ... & Sham, P. C. (2007). *PLINK: a tool set for whole-genome association and population-based linkage analyses*. Am J Hum Genet, 81(3), 559–575. http://pngu.mgh.harvard.edu/purcell/plink/  

- [`run1/`](./SNP/run1): folder containing raw output files from running `snp_calling.sh`.  
  - [`VCF.coronavirus_Wuhan.vcf`](./SNP/run1/VCF.coronavirus_Wuhan.vcf) — variant call format (VCF) file produced by kSNP3  

- [`plink_convert.sh`](./SNP/plink_convert.sh): script used to convert the VCF file into PLINK format  
- [`plink.log`](./SNP/plink.log): log file recording the PLINK command execution  

- [`cov19_snp/`](./SNP/cov19_snp): folder containing SNP data converted into PLINK format.  
  - [`cov19.ped`](./SNP/cov19_snp/cov19.ped): PLINK `.ped` file generated by `plink_convert.sh`  
  - [`cov19.map`](./SNP/cov19_snp/cov19.map): PLINK `.map` file generated by `plink_convert.sh`  

- [`SNP_analysis/`](./SNP/SNP_analysis): folder containing scripts and outputs for SNP data analysis
  - [`SNP_analysis.Rmd`](./SNP/SNP_analysis/SNP_analysis.Rmd): R script (R Markdown) used for analysis  
  - [`SNP_analysis.nb.html`](./SNP/SNP_analysis/SNP_analysis.nb.html) and [`SNP_analysis.pdf`](./SNP/SNP_analysis/SNP_analysis.pdf): preview of the analysis without rerunning the code  
  - [`plot/`](./SNP/SNP_analysis/plot): folder containing data visualization plots  

---

## Phylogeny Inference

The directory [`phylogeny`](./phylogeny) contains the scripts, intermediate files, and visualizations for the Spike protein sequence.

- [`phy_infer.sh`](./phylogeny/phy_infer.sh): script that  
  1. Builds a BLAST-able database (see [`blastdb`](./phylogeny/blastdb)) for every selected virus genome (see [`single_genome`](./single_genome), [`sample_info2.txt`](./sample_info2.txt))
     > Camacho, C., Coulouris, G., Avagyan, V., Ma, N., Papadopoulos, J., Bealer, K., & Madden, T. L. (2009). *BLAST+: architecture and applications*. BMC Bioinformatics, 10, 421. https://doi.org/10.1186/1471-2105-10-421 
  3. BLASTs the reference Spike protein sequence ([`spike_protein_ref.fa`](./phylogeny/spike_protein_ref.fa)) against all databases to retrieve Spike protein coordinates  
  4. Uses **samtools** to extract Spike protein sequences from the genomes based on coordinate information (final sequences stored in [`spike_protein_all_shortname.fa`](./phylogeny/spike_protein_all_shortname.fa))
     > Li, H., Handsaker, B., Wysoker, A., Fennell, T., Ruan, J., Homer, N., ... & Durbin, R. (2009). *The Sequence Alignment/Map format and SAMtools*. Bioinformatics, 25(16), 2078–2079. https://doi.org/10.1093/bioinformatics/btp352
  6. Aligns sequences with **MAFFT**, output stored as [`cov19_aln.clustal`](./phylogeny/cov19_aln.clustal)
     > Katoh, K., & Standley, D. M. (2013). *MAFFT multiple sequence alignment software version 7: improvements in performance and usability*. Mol Biol Evol, 30(4), 772–780. https://doi.org/10.1093/molbev/mst010  
  8. Uses **IQ-TREE 2** to build a maximum-likelihood tree, output stored in [`iqtree_output`](./phylogeny/iqtree_output)
     > Minh, B. Q., Schmidt, H. A., Chernomor, O., Schrempf, D., Woodhams, M. D., von Haeseler, A., & Lanfear, R. (2020). *IQ-TREE 2: new models and efficient methods for phylogenetic inference in the genomic era*. Mol Biol Evol, 37(5), 1530–1534. https://doi.org/10.1093/molbev/msaa015  

- [`tree.Rmd`](./phylogeny/tree.Rmd): script used for visualizing the tree result  
  - [`tree.nb.html`](./phylogeny/tree.nb.html) and [`Tree Visualization.pdf`](./phylogeny/Tree%20Visualization.pdf): preview of the analysis without rerunning the code  

- [`tree_plot/`](./phylogeny/tree_plot): folder containing final tree visualization plots  
